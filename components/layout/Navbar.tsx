"use client";
import React, { useState, useEffect } from "react";
import Link from "next/link";
import { Button } from "../ui/Button";
import Image from "next/image";
import { motion, AnimatePresence } from "framer-motion";
import { FiMenu, FiX, FiChevronRight, FiChevronLeft, FiSearch } from "react-icons/fi";

// --- Icons ---
const Phone = () => (
  <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M17.3547 15.6569C17.3547 15.6569 16.2573 16.7346 15.9884 17.0506C15.5504 17.5181 15.0342 17.7388 14.3576 17.7388C14.2926 17.7388 14.2232 17.7388 14.1581 17.7345C12.87 17.6522 11.6729 17.1502 10.7751 16.7216C8.32023 15.5357 6.16463 13.8519 4.37335 11.7181C2.89436 9.93911 1.90547 8.29433 1.25055 6.52836C0.847192 5.4506 0.699727 4.6109 0.764785 3.81881C0.808157 3.31239 1.00333 2.89254 1.36332 2.53328L2.84231 1.05731C3.05484 0.858209 3.28037 0.75 3.50157 0.75C3.77482 0.75 3.99601 0.914478 4.13481 1.05299C4.13914 1.05731 4.14348 1.06164 4.14782 1.06597C4.41239 1.31269 4.66395 1.56806 4.92852 1.84075C5.06297 1.97925 5.20176 2.11776 5.34055 2.2606L6.52462 3.44224C6.98436 3.90105 6.98436 4.32523 6.52462 4.78403C6.39884 4.90955 6.27739 5.03508 6.15161 5.15627C5.78729 5.52851 6.07349 5.24289 5.69615 5.58051C5.68747 5.58916 5.6788 5.59349 5.67446 5.60215C5.30146 5.97439 5.37086 6.33797 5.44893 6.58468C5.45326 6.59767 5.4576 6.61065 5.46194 6.62364C5.76988 7.36812 6.2036 8.06931 6.86286 8.90469L6.8672 8.90901C8.06427 10.3807 9.3264 11.5277 10.7187 12.4063C10.8965 12.5189 11.0786 12.6098 11.2521 12.6963C11.4083 12.7742 11.5557 12.8478 11.6815 12.9257C11.6989 12.9344 11.7162 12.9474 11.7336 12.956C11.881 13.0296 12.0198 13.0642 12.1629 13.0642C12.5229 13.0642 12.7485 12.8392 12.8222 12.7656L13.6724 11.9172C13.8198 11.77 14.054 11.5925 14.3273 11.5925C14.5962 11.5925 14.8174 11.7613 14.9518 11.9085C14.9562 11.9128 14.9562 11.9128 14.9605 11.9172L17.3503 14.3021C17.7971 14.7436 17.3547 15.6569 17.3547 15.6569Z"
      stroke="#FAF5EB"
      strokeWidth="1.5"
      strokeLinecap="round"
      strokeLinejoin="round"
    />
  </svg>
);
const WhatsApp = () => (
  <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path
      d="M3.51758 3.42188C7.43479 -0.471899 13.761 -0.47378 17.6807 3.41602C19.5 5.32663 20.5935 7.81989 20.4941 10.3887L20.4932 10.3984V10.4082C20.4932 15.8969 16.0785 20.2898 10.5498 20.29C8.94597 20.29 7.33764 19.8917 5.8252 19.0898L5.65332 18.999L5.46387 19.0479L0.712891 20.2949L1.95898 15.7852L2.01367 15.585L1.91211 15.4053C-0.299936 11.5072 0.30516 6.61525 3.51758 3.42188ZM18.0967 5.13965C15.3355 1.233 9.9669 -0.0453429 5.74414 2.64551C1.40368 5.41146 0.0628238 10.9561 2.73633 15.3857L2.74316 15.3955L2.75 15.4062L2.83301 15.5312L2.04883 18.458L1.82715 19.2852L2.65625 19.0723L5.71094 18.2881L5.84277 18.376L5.8623 18.3887L5.88281 18.3994C7.31778 19.1675 8.87539 19.6123 10.5498 19.6123C12.343 19.6122 14.0145 19.0552 15.4521 18.1758C19.8123 15.5085 21.0309 9.84716 18.3594 5.53125L18.3564 5.52539L18.0967 5.13965ZM7.35059 6.08398C7.37108 6.14486 7.39568 6.24134 7.41699 6.38965L7.42578 6.44922L7.44824 6.50488C7.5552 6.7707 7.74145 7.22091 7.91504 7.61914C8.00163 7.81779 8.08677 8.00828 8.1582 8.15723C8.19358 8.23099 8.2286 8.29959 8.25977 8.35645C8.26623 8.36823 8.27324 8.38039 8.28027 8.39258L8.25586 8.41797V8.58105C8.25278 8.58863 8.24902 8.5987 8.24316 8.61035C8.23387 8.62883 8.22238 8.64644 8.21191 8.66211C8.07686 8.75002 7.97871 8.85298 7.91113 8.93359C7.87038 8.98222 7.83096 9.03373 7.80859 9.0625C7.7958 9.07895 7.78667 9.09081 7.7793 9.09961C7.77439 9.10546 7.77147 9.10834 7.77051 9.10938C7.58651 9.29229 7.32842 9.73102 7.57129 10.2139L7.58496 10.2412L7.60254 10.2676C8.04416 10.926 8.59278 11.5804 9.1416 12.126L9.1582 12.1426L9.17578 12.1562C9.85324 12.7175 10.6351 13.1609 11.4082 13.4902V13.4883C11.5599 13.5598 11.7599 13.6216 11.9775 13.5908C12.2128 13.5574 12.4094 13.4244 12.5361 13.2217C12.6655 13.0802 12.8251 12.8718 12.9531 12.7021C13.123 12.4769 13.2545 12.3047 13.3281 12.2314C13.34 12.2197 13.3498 12.212 13.3564 12.207C13.3634 12.2095 13.3731 12.2134 13.3857 12.2197C13.4992 12.2761 13.9049 12.4636 14.2949 12.6445C14.6961 12.8306 15.0821 13.0101 15.1797 13.0586L15.3799 13.1572C15.4114 13.397 15.3839 13.614 15.2822 13.8281C14.9086 14.3723 14.3944 14.7651 13.8545 14.8418L13.8438 14.8438C13.2553 14.9412 12.8305 14.93 12.4219 14.7676L12.3799 14.751L12.335 14.7422L12.1641 14.7031C11.7812 14.605 11.4553 14.4464 10.9658 14.251C9.27016 13.456 7.85974 12.1603 6.74121 10.543L6.73535 10.5352L6.72852 10.5264C6.16407 9.77813 5.87552 8.93276 5.77539 8.07227C5.7824 7.38761 6.03945 6.78842 6.57715 6.25391C6.57787 6.25323 6.5819 6.24855 6.59082 6.24121C6.60077 6.23302 6.61382 6.2225 6.62988 6.21094C6.66247 6.18748 6.70227 6.16223 6.74316 6.13965C6.78453 6.11683 6.82087 6.10054 6.84863 6.09082C6.85982 6.08691 6.86741 6.08487 6.87109 6.08398H7.35059Z"
      fill="#FAF5EB"
      stroke="#FAF5EB"
    />
  </svg>
);
const SearchIcon = () => (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="20"
    height="20"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    strokeWidth="2"
    strokeLinecap="round"
    strokeLinejoin="round"
  >
    <circle cx="11" cy="11" r="8" />
    <path d="m21 21-4.3-4.3" />
  </svg>
);

const PhoneMobile = () => (
  <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M15.5756 13.9118C15.5756 13.9118 14.5958 14.8634 14.3557 15.1424C13.9646 15.5551 13.5038 15.75 12.8997 15.75C12.8416 15.75 12.7796 15.75 12.7215 15.7462C11.5714 15.6736 10.5026 15.2303 9.70098 14.8519C7.50913 13.8048 5.58449 12.3182 3.98514 10.4341C2.66461 8.86338 1.78167 7.41115 1.19692 5.85191C0.836779 4.90032 0.705113 4.15892 0.763201 3.45955C0.801926 3.01242 0.976189 2.64172 1.29761 2.32452L2.61814 1.02134C2.80789 0.845541 3.00926 0.75 3.20676 0.75C3.45073 0.75 3.64823 0.895223 3.77215 1.01752C3.77602 1.02134 3.77989 1.02516 3.78377 1.02898C4.01999 1.24682 4.2446 1.47229 4.48082 1.71306C4.60087 1.83535 4.72479 1.95764 4.84871 2.08376L5.90591 3.12707C6.31639 3.53217 6.31639 3.90669 5.90591 4.31178C5.7936 4.42261 5.68517 4.53344 5.57287 4.64045C5.24758 4.96911 5.50311 4.71693 5.1662 5.01502C5.15846 5.02266 5.15071 5.02648 5.14684 5.03413C4.8138 5.36279 4.87576 5.68381 4.94547 5.90164C4.94934 5.91311 4.95322 5.92457 4.95709 5.93604C5.23204 6.59336 5.61929 7.21247 6.20791 7.95005L6.21178 7.95387C7.2806 9.25323 8.4075 10.266 9.65058 11.0418C9.80936 11.1411 9.972 11.2214 10.1269 11.2978C10.2663 11.3666 10.398 11.4316 10.5103 11.5004C10.5258 11.508 10.5413 11.5195 10.5568 11.5271C10.6884 11.5921 10.8123 11.6227 10.9401 11.6227C11.2615 11.6227 11.4629 11.4239 11.5288 11.359L12.2878 10.6099C12.4195 10.4799 12.6286 10.3232 12.8726 10.3232C13.1127 10.3232 13.3102 10.4723 13.4302 10.6022C13.4341 10.6061 13.4341 10.6061 13.438 10.6099L15.5717 12.7156C15.9706 13.1054 15.5756 13.9118 15.5756 13.9118Z" stroke="#001446" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>

);
const WhatsAppMobile = () => (
 <svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.21582 3.12988C6.74321 -0.376591 12.4413 -0.376515 15.9688 3.12988C17.6037 4.84993 18.5833 7.0911 18.4941 9.39746V9.41699C18.4941 14.3565 14.5211 18.3104 9.54492 18.3105C8.10184 18.3105 6.6547 17.9514 5.29297 17.2295L5.12012 17.1387L4.93164 17.1885L0.712891 18.2959L1.81836 14.2939L1.87305 14.0947L1.77148 13.9141C-0.219509 10.4055 0.324953 6.00366 3.21582 3.12988ZM16.4121 4.62305C13.9 1.06864 9.01513 -0.0954282 5.17188 2.35352C1.22309 4.86978 0.00300829 9.91512 2.43555 13.9453L2.44141 13.9551L2.44824 13.9648L2.51172 14.0605L1.80762 16.6885L1.58594 17.5146L2.41504 17.3018L5.1582 16.5977L5.25977 16.665L5.2793 16.6777L5.2998 16.6895C6.60416 17.3876 8.02121 17.792 9.54492 17.792C11.1773 17.792 12.6979 17.2848 14.0049 16.4854C17.9731 14.0578 19.0817 8.90589 16.6514 4.97949V4.97852L16.6484 4.97363L16.4121 4.62305ZM6.61523 5.55273C6.63022 5.60496 6.64863 5.68073 6.66406 5.78809L6.67188 5.84766L6.69434 5.90332C6.79127 6.14421 6.96088 6.55226 7.11816 6.91309C7.19652 7.09283 7.27393 7.26499 7.33887 7.40039C7.3711 7.4676 7.40279 7.53137 7.43164 7.58398V7.58496L7.42188 7.5957V7.75488C7.42005 7.75895 7.41864 7.76432 7.41602 7.76953C7.4104 7.78068 7.4027 7.79078 7.39648 7.80078C7.27223 7.88299 7.18256 7.97844 7.12109 8.05176C7.08343 8.09668 7.04706 8.14455 7.02734 8.16992L6.99707 8.20801C6.82314 8.38091 6.57497 8.79892 6.80762 9.26172L6.82129 9.29004L6.83887 9.31641C7.24028 9.9149 7.73874 10.5092 8.2373 11.0049L8.25391 11.0215L8.27148 11.0352C8.88868 11.5464 9.60091 11.9496 10.3037 12.249V12.248C10.4457 12.3146 10.6355 12.3733 10.8438 12.3438C11.0697 12.3117 11.259 12.1847 11.3809 11.9922C11.4998 11.8616 11.644 11.6713 11.7578 11.5205C11.9126 11.3154 12.0283 11.1628 12.0918 11.0996C12.1977 11.1521 12.5638 11.3209 12.9141 11.4834C13.2774 11.652 13.6254 11.8139 13.7129 11.8574L13.8711 11.9355C13.8933 12.1329 13.8688 12.3106 13.7871 12.4854C13.4537 12.9706 12.9989 13.314 12.5283 13.3809L12.5176 13.3828C11.9896 13.4703 11.6151 13.4597 11.2568 13.3174L11.2139 13.2998L11.1689 13.291C10.7567 13.209 10.4504 13.0542 9.94043 12.8506C8.41572 12.1355 7.14562 10.9691 6.1377 9.51172L6.13184 9.50391L6.12598 9.49512L5.94629 9.2373C5.55935 8.63587 5.3523 7.97514 5.27344 7.30273C5.27994 6.69715 5.50647 6.16648 5.98438 5.69141C5.98701 5.68907 6.00036 5.67692 6.02637 5.6582C6.05441 5.63802 6.08877 5.61615 6.12402 5.59668C6.15967 5.57701 6.18994 5.56338 6.21191 5.55566C6.21565 5.55436 6.21922 5.55348 6.22168 5.55273H6.61523Z" fill="#001446" stroke="#001446"/>
</svg>

);

export const Navbar = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [activeMenu, setActiveMenu] = useState<"main" | "location" | "dining">("main");

  // Prevent scrolling when menu is open
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "unset";
    }
  }, [isOpen]);

  // Reset active menu when closing
  const closeMenu = () => {
    setIsOpen(false);
    setTimeout(() => setActiveMenu("main"), 300); // Reset after animation
  };

  return (
    // Modified header class: bg-[#001446] for mobile, md:bg-transparent for desktop
    <header className="w-full bg-[#001446] md:bg-transparent  md:hover:bg-[#001446] transition-colors duration-300 text-[#FAF5EB] flex flex-col items-center absolute z-50">
      {/* --- DESKTOP NAVBAR --- */}
      <div className="hidden md:flex flex-col w-full items-center">
        {/* Top Row */}
        <div className="w-full px-8 py-7 flex justify-between items-center relative border-b border-[FEFFFF]">
          {/* Left Actions */}
          <div className="flex items-center gap-6 z-10">
            <button className="hover:opacity-80">
              <Phone />
            </button>
            <button className="hover:opacity-80">
              <WhatsApp />
            </button>
          </div>

          {/* Logo (Centered) */}
          <Link href={"/"}>
            <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center">
              <Image src="/svgs/edenNav.svg" alt="Logo" width={100} height={100} />
            </div>
          </Link>

          {/* Right Actions */}
          <div className="flex items-center gap-6 z-10">
            <button className="hover:opacity-80">
              <SearchIcon />
            </button>
            <Button variant="primary">Book Now</Button>
          </div>
        </div>

        {/* Bottom Row: Navigation */}
        <nav className="w-full flex justify-center py-5 relative z-50">
          <div className="flex items-center gap-32 text-lg ">
            {/* --- Locations Dropdown --- */}
            <div className="relative group cursor-pointer">
              <span className="hover:opacity-80 transition-opacity border-b-2 border-transparent group-hover:border-[#FEFFFF] pb-1">Locations</span>
              <div className="absolute top-full left-0 pt-4 w-80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top">
                <div className="bg-[#001446] flex flex-col p-6 shadow-xl">
                  <Link href="/location/gokarna" className="group/item block mb-4">
                    <div className="">
                      <span className="relative text-base">
                        Eden Ember Castle Gokarna
                        <span className="absolute -bottom-1 left-0 w-0 h-[1px] bg-white transition-all duration-300 group-hover/item:w-full"></span>
                      </span>
                    </div>
                  </Link>
                  <Link href="/location/karwar" className="group/item block">
                    <span className="relative text-base">
                      Hotel Eden Karwar
                      <span className="absolute -bottom-1 left-0 w-0 h-[1px] bg-white transition-all duration-300 group-hover/item:w-full"></span>
                    </span>
                  </Link>
                </div>
              </div>
            </div>

            {/* --- Dining Dropdown (Center Aligned) --- */}
            <div className="relative group cursor-pointer">
              <Link href="/dining">
                <span className="hover:opacity-80 transition-opacity border-b-2 border-transparent group-hover:border-[#FEFFFF] pb-1">Dining</span>
              </Link>

              <div className="absolute top-full left-1/2 -translate-x-1/2 pt-4 w-80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform origin-top">
                <div className="bg-[#001446] flex flex-col p-6 shadow-xl">
                  {/* Item 1: Tulip – Fine Dine Multi-Cuisine */}
                  <Link href="/dining/tulip" className="group/item block mb-4">
                    <div className="">
                      <span className="relative text-base">
                        Tulip – Fine Dine Multi-Cuisine
                        <span className="absolute -bottom-1 left-0 w-0 h-[1px] bg-white transition-all duration-300 group-hover/item:w-full"></span>
                      </span>
                    </div>
                  </Link>

                  {/* Item 2: Oyster Bay – Coastal Seafood Dining */}
                  <Link href="/dining/oyster-bay" className="group/item block mb-4">
                    <span className="relative text-base">
                      Oyster Bay – Coastal Seafood Dining
                      <span className="absolute -bottom-1 left-0 w-0 h-[1px] bg-white transition-all duration-300 group-hover/item:w-full"></span>
                    </span>
                  </Link>
                  <Link href="/dining/food-and-forest" className="group/item block">
                    <span className="relative text-base">
                      Food & Forest – Rooftop Casual Dining
                      <span className="absolute -bottom-1 left-0 w-0 h-[1px] bg-white transition-all duration-300 group-hover/item:w-full"></span>
                    </span>
                  </Link>
                </div>
              </div>
            </div>

            <Link href="/spa" className="hover:opacity-80 transition-opacity">
              Spa
            </Link>
            <Link href="/contact" className="hover:opacity-80 transition-opacity">
              Contact
            </Link>
          </div>
        </nav>
      </div>

      {/* --- MOBILE NAVBAR --- */}
      <div className="md:hidden w-full flex justify-between items-center px-4 py-4 relative z-[60] bg-[#001446]">
        <div className="flex items-center gap-4">
          <button onClick={() => setIsOpen(!isOpen)} className="text-2xl">
            {isOpen ? <FiX /> : <FiMenu />}
          </button>
          <button className="text-xl">
            <FiSearch />
          </button>
        </div>

        <Link href="/" onClick={closeMenu}>
          <Image src="/svgs/edenNav.svg" alt="Logo" width={80} height={80} />
        </Link>

        <div className="flex items-center gap-4">
          {/* Book Now Button simplified for mobile if needed, or keeping standard */}
          <Link href="#" className="bg-white text-[#001446] px-4 py-2 text-sm font-medium">
            Book
          </Link>
        </div>
      </div>

      {/* --- MOBILE DRAWER --- */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, y: -20 }}
            animate={{ opacity: 1, y: 0 }}
            exit={{ opacity: 0, y: -20 }}
            transition={{ duration: 0.3 }}
            className="fixed inset-0  w-[80%] top-[72px] bg-white text-[#001446] z-50 md:hidden flex flex-col"
          >
            <div className="w-full h-full relative overflow-hidden">
              {/* Main Menu */}
              <motion.div
                className="absolute inset-0 w-full h-full p-6 flex flex-col"
                initial={{ x: 0 }}
                animate={{ x: activeMenu === "main" ? 0 : "-100%" }}
                transition={{ type: "tween" }}
              >
                <div className="flex gap-6 mb-8">
                  <PhoneMobile />
                  <WhatsAppMobile />
                </div>

                <nav className="flex flex-col gap-6 text-xl font-medium">
                  <button onClick={() => setActiveMenu("location")} className="flex items-center justify-between border-b pb-4 border-gray-200">
                    <span>Location</span>
                    <FiChevronRight />
                  </button>
                  <button onClick={() => setActiveMenu("dining")} className="flex items-center justify-between border-b pb-4 border-gray-200">
                    <span>Dining</span>
                    <FiChevronRight />
                  </button>
                  <Link href="/spa" onClick={closeMenu} className="border-b pb-4 border-gray-200">
                    Spa
                  </Link>
                  <Link href="/contact" onClick={closeMenu} className="">
                    Contact
                  </Link>
                </nav>
              </motion.div>

              {/* Location Submenu */}
              <motion.div
                className="absolute inset-0 w-full h-full p-6 bg-white"
                initial={{ x: "100%" }}
                animate={{ x: activeMenu === "location" ? 0 : "100%" }}
                transition={{ type: "tween" }}
              >
                <button onClick={() => setActiveMenu("main")} className="flex items-center gap-2 mb-8 text-[#001446] font-medium">
                  <FiChevronLeft /> <span>Location</span>
                </button>
                <nav className="flex flex-col gap-6 text-lg text-gray-600">
                  <Link href="/location/gokarna" onClick={closeMenu} className="border-b pb-4 border-gray-100">
                    Eden Ember Castle Gokarna
                  </Link>
                  <Link href="/location/karwar" onClick={closeMenu} className="">
                    Hotel Eden Karwar
                  </Link>
                </nav>
              </motion.div>

              {/* Dining Submenu */}
              <motion.div
                className="absolute inset-0 w-full h-full p-6 bg-white"
                initial={{ x: "100%" }}
                animate={{ x: activeMenu === "dining" ? 0 : "100%" }}
                transition={{ type: "tween" }}
              >
                <button onClick={() => setActiveMenu("main")} className="flex items-center gap-2 mb-8 text-[#001446] font-medium">
                  <FiChevronLeft /> <span>Dining</span>
                </button>
                <nav className="flex flex-col gap-6 text-lg text-gray-600">
                  <Link href="/dining/tulip" onClick={closeMenu} className="border-b pb-4 border-gray-100">
                    Tulip - Fine Dine Multi-Cuisine
                  </Link>
                  <Link href="/dining/oyster-bay" onClick={closeMenu} className="border-b pb-4 border-gray-100">
                    Oyster Bay - Coastal Seafood Dining
                  </Link>
                  <Link href="/dining/food-and-forest" onClick={closeMenu} className="">
                    Food & Forest - Rooftop Casual Dining
                  </Link>
                </nav>
              </motion.div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </header>
  );
};